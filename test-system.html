<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 5px solid #667eea;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .success-btn {
            background: #48bb78;
        }
        
        .success-btn:hover {
            background: #38a169;
        }
        
        .danger-btn {
            background: #f56565;
        }
        
        .danger-btn:hover {
            background: #e53e3e;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 10px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .result-box {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-box.success {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .result-box.error {
            border-color: #f56565;
            background: #fff5f5;
        }
        
        .result-box.info {
            border-color: #4299e1;
            background: #ebf8ff;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .status.online {
            background: #48bb78;
            color: white;
        }
        
        .status.offline {
            background: #f56565;
            color: white;
        }
        
        .status.testing {
            background: #ed8936;
            color: white;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .metric-card {
            padding: 15px;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        pre {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #48bb78);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat-item {
            padding: 10px;
            background: #f7fafc;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .stat-label {
            font-size: 11px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h1>
        <p class="subtitle">Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„ÙƒÙ„ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª - V2.0</p>
        
        <!-- System Status -->
        <div class="test-section">
            <h2>
                ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
                <span id="systemStatus" class="status offline">ØºÙŠØ± Ù…ØªØµÙ„</span>
            </h2>
            <div class="grid">
                <div class="metric-card">
                    <div class="metric-value" id="apiStatus">âš«</div>
                    <div class="metric-label">API Server</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="dbStatus">âš«</div>
                    <div class="metric-label">Database</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="aiStatus">âš«</div>
                    <div class="metric-label">AI Services</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="ragStatus">âš«</div>
                    <div class="metric-label">RAG System</div>
                </div>
            </div>
            <button onclick="checkSystemStatus()">ğŸ”„ ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
            <div id="statusResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- OpenAI Service Test -->
        <div class="test-section">
            <h2>ğŸ¤– OpenAI Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('openai', 'basic')">Ø£Ø³Ø§Ø³ÙŠ</button>
                <button class="tab" onclick="switchTab('openai', 'smart')">Ø°ÙƒÙŠ</button>
                <button class="tab" onclick="switchTab('openai', 'performance')">Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
            </div>
            
            <div id="openai-basic" class="tab-content active">
                <input type="text" id="openaiPrompt" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø·Ù„Ø¨..." value="Ø§Ø´Ø±Ø­ Ø§Ù„ÙƒØ³ÙˆØ± Ù„Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³">
                <select id="modelSelect">
                    <option value="auto">Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 (Ø±Ø®ÙŠØµ)</option>
                    <option value="gpt-4o-mini">GPT-4 Mini (Ù…ØªÙˆØ§Ø²Ù†)</option>
                    <option value="gpt-4o">GPT-4 (Ù‚ÙˆÙŠ)</option>
                </select>
                <button onclick="testOpenAI()">ğŸš€ Ø§Ø®ØªØ¨Ø±</button>
                <button onclick="testSmartModelSelection()" class="success-btn">ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒÙŠ</button>
            </div>
            
            <div id="openai-smart" class="tab-content">
                <button onclick="testTaskDetection()">ğŸ¯ ÙƒØ´Ù Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
                <button onclick="testCostOptimization()">ğŸ’° Ø§Ø®ØªØ¨Ø§Ø± ØªÙˆÙÙŠØ± Ø§Ù„ØªÙƒÙ„ÙØ©</button>
                <button onclick="testJSONGeneration()">ğŸ“‹ ØªÙˆÙ„ÙŠØ¯ JSON</button>
            </div>
            
            <div id="openai-performance" class="tab-content">
                <button onclick="testOpenAIPerformance()">âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
                <button onclick="getOpenAIStats()">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
                <button onclick="clearOpenAICache()" class="danger-btn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´</button>
            </div>
            
            <div id="openaiResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- RAG Service Test -->
        <div class="test-section">
            <h2>ğŸ” RAG Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('rag', 'qa')">Ø£Ø³Ø¦Ù„Ø© ÙˆØ£Ø¬ÙˆØ¨Ø©</button>
                <button class="tab" onclick="switchTab('rag', 'quiz')">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
                <button class="tab" onclick="switchTab('rag', 'personalized')">Ø´Ø®ØµÙŠ</button>
            </div>
            
            <div id="rag-qa" class="tab-content active">
                <input type="text" id="ragQuestion" placeholder="Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„..." value="Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠØ©ØŸ">
                <input type="text" id="ragLessonId" placeholder="Lesson ID (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" value="">
                <button onclick="testRAG()">ğŸ” Ø§Ø¨Ø­Ø«</button>
                <button onclick="testRAGWithContext()" class="success-btn">ğŸ“š Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³ÙŠØ§Ù‚</button>
            </div>
            
            <div id="rag-quiz" class="tab-content">
                <select id="quizDifficulty">
                    <option value="easy">Ø³Ù‡Ù„</option>
                    <option value="medium">Ù…ØªÙˆØ³Ø·</option>
                    <option value="hard">ØµØ¹Ø¨</option>
                </select>
                <button onclick="generateQuizQuestions()">ğŸ“ ØªÙˆÙ„ÙŠØ¯ Ø£Ø³Ø¦Ù„Ø©</button>
                <button onclick="explainConcept()">ğŸ’¡ Ø´Ø±Ø­ Ù…ÙÙ‡ÙˆÙ…</button>
            </div>
            
            <div id="rag-personalized" class="tab-content">
                <input type="text" id="userId" placeholder="User ID" value="user123">
                <button onclick="generateStudyPlan()">ğŸ“… Ø®Ø·Ø© Ø¯Ø±Ø§Ø³ÙŠØ©</button>
                <button onclick="explainWrongAnswer()">âŒ Ø´Ø±Ø­ Ø®Ø·Ø£</button>
            </div>
            
            <div id="ragResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Quiz Service Test -->
        <div class="test-section">
            <h2>ğŸ“ Quiz Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('quiz', 'generate')">ØªÙˆÙ„ÙŠØ¯</button>
                <button class="tab" onclick="switchTab('quiz', 'adaptive')">ØªÙƒÙŠÙÙŠ</button>
                <button class="tab" onclick="switchTab('quiz', 'analysis')">ØªØ­Ù„ÙŠÙ„</button>
            </div>
            
            <div id="quiz-generate" class="tab-content active">
                <input type="text" id="quizLessonId" placeholder="Lesson ID" value="clq5vx3w3001el20878ub6y1i">
                <input type="number" id="questionCount" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©" value="5" min="1" max="10">
                <button onclick="generateQuiz()">ğŸ“ ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±</button>
                <button onclick="startQuizSession()" class="success-btn">ğŸ® Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø©</button>
            </div>
            
            <div id="quiz-adaptive" class="tab-content">
                <input type="text" id="studentId" placeholder="Student ID" value="student123">
                <button onclick="generateAdaptiveQuiz()">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒÙŠÙÙŠ</button>
                <button onclick="submitAnswer()">âœ… ØªØ³Ù„ÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø©</button>
                <button onclick="getInstantFeedback()">ğŸ’¬ ØªÙ‚ÙŠÙŠÙ… ÙÙˆØ±ÙŠ</button>
            </div>
            
            <div id="quiz-analysis" class="tab-content">
                <button onclick="completeQuiz()">ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                <button onclick="getQuizStatistics()">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <button onclick="getQuizHistory()">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            
            <div id="quizResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teaching Assistant Test -->
        <div class="test-section">
            <h2>ğŸ‘¨â€ğŸ« Teaching Assistant</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('teaching', 'basic')">Ø£Ø³Ø§Ø³ÙŠ</button>
                <button class="tab" onclick="switchTab('teaching', 'emotional')">Ø¹Ø§Ø·ÙÙŠ</button>
                <button class="tab" onclick="switchTab('teaching', 'adaptive')">ØªÙƒÙŠÙÙŠ</button>
            </div>
            
            <div id="teaching-basic" class="tab-content active">
                <textarea id="slideContent" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø±ÙŠØ­Ø©..." rows="3">Ø§Ù„ÙƒØ³ÙˆØ±: Ù‡ÙŠ Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</textarea>
                <input type="text" id="studentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" value="Ø£Ø­Ù…Ø¯">
                <input type="number" id="studentGrade" placeholder="Ø§Ù„ØµÙ" value="5" min="1" max="12">
                <button onclick="generateTeachingScript()">ğŸ¤ ØªÙˆÙ„ÙŠØ¯ Ø³ÙƒØ±ÙŠØ¨Øª</button>
            </div>
            
            <div id="teaching-emotional" class="tab-content">
                <select id="emotionalState">
                    <option value="happy">Ø³Ø¹ÙŠØ¯ ğŸ˜Š</option>
                    <option value="neutral">Ø¹Ø§Ø¯ÙŠ ğŸ˜</option>
                    <option value="frustrated">Ù…Ø­Ø¨Ø· ğŸ˜”</option>
                    <option value="confused">Ù…Ø±ØªØ¨Ùƒ ğŸ˜•</option>
                    <option value="tired">Ù…ØªØ¹Ø¨ ğŸ˜´</option>
                </select>
                <button onclick="generateEmotionalScript()">ğŸ’– Ø³ÙƒØ±ÙŠØ¨Øª Ø¹Ø§Ø·ÙÙŠ</button>
                <button onclick="detectEmotionalState()">ğŸ” ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø©</button>
                <button onclick="generateMotivation()">ğŸ’ª Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©</button>
            </div>
            
            <div id="teaching-adaptive" class="tab-content">
                <select id="interactionType">
                    <option value="explain">Ø´Ø±Ø­</option>
                    <option value="socratic">Ø³Ù‚Ø±Ø§Ø·ÙŠ</option>
                    <option value="example">Ù…Ø«Ø§Ù„</option>
                    <option value="problem">Ù…Ø³Ø£Ù„Ø©</option>
                    <option value="hint">ØªÙ„Ù…ÙŠØ­</option>
                    <option value="check">ØªØ­Ù‚Ù‚</option>
                </select>
                <button onclick="handleInteraction()">ğŸ”„ ØªÙØ§Ø¹Ù„</button>
                <button onclick="getProgressReport()">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…</button>
                <button onclick="generateParentReport()">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù‡Ù„</button>
            </div>
            
            <div id="teachingResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Integration Test -->
        <div class="test-section">
            <h2>ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„</h2>
            <button onclick="testFullFlow()">ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <button onclick="testAdaptiveLearning()" class="success-btn">ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙƒÙŠÙÙŠ</button>
            <button onclick="testEmotionalFlow()">ğŸ’– Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ</button>
            <button onclick="stressTest()" class="danger-btn">âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ·</button>
            <div class="progress-bar" id="integrationProgress" style="display:none;">
                <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
            </div>
            <div id="integrationResult" class="result-box" style="display:none;"></div>
        </div>
    </div>
    
    <script>

        // ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© script section
let availableLessonId = null;

// Function Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ lesson ID ØµØ§Ù„Ø­
async function getAvailableLessonId() {
    try {
        const response = await fetch(`${API_BASE}/lessons/available`);
        const data = await response.json();
        
        if (data.success && data.lessons.length > 0) {
            availableLessonId = data.lessons[0].id;
            console.log('âœ… Using lesson ID:', availableLessonId);
            
            // Ø­Ø¯Ø« ÙƒÙ„ input fields
            document.getElementById('ragLessonId').value = availableLessonId;
            document.getElementById('quizLessonId').value = availableLessonId;
            
            // Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØªØ§Ø­Ø©
            showResult('statusResult', `
                <h3>ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>
                ${data.lessons.map(l => `
                    <p>â€¢ ${l.title} (${l.id})</p>
                `).join('')}
            `, 'info');
        } else {
            console.error('âŒ No lessons with content found');
        }
    } catch (error) {
        console.error('Error fetching lessons:', error);
    }
}

        // Configuration
        const API_BASE = 'http://localhost:3000/api';
        let currentTest = null;
        let currentSession = null;
        
        // Utility Functions
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result-box ${type}`;
            element.innerHTML = content;
        }
        
        function showLoading(elementId) {
            showResult(elementId, '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', 'info');
        }
        
        function formatJSON(obj) {
            return `<pre>${JSON.stringify(obj, null, 2)}</pre>`;
        }
        
        function switchTab(section, tab) {
            // Hide all tabs in section
            document.querySelectorAll(`#${section}- .tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(`${section}-${tab}`).classList.add('active');
            
            // Update tab buttons
            const buttons = event.target.parentElement.querySelectorAll('.tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // System Status Check
        async function checkSystemStatus() {
            showLoading('statusResult');
            
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                // Update status indicators
                document.getElementById('systemStatus').className = 'status online';
                document.getElementById('systemStatus').textContent = 'Ù…ØªØµÙ„';
                
                document.getElementById('apiStatus').textContent = 'ğŸŸ¢';
                document.getElementById('dbStatus').textContent = data.database ? 'ğŸŸ¢' : 'ğŸ”´';
                document.getElementById('aiStatus').textContent = data.openai ? 'ğŸŸ¢' : 'ğŸŸ¡';
                document.getElementById('ragStatus').textContent = data.rag ? 'ğŸŸ¢' : 'ğŸŸ¡';
                
                showResult('statusResult', `
                    <h3>âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">âœ…</div>
                            <div class="stat-label">API</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">âœ…</div>
                            <div class="stat-label">Database</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${data.openai ? 'âœ…' : 'âš ï¸'}</div>
                            <div class="stat-label">OpenAI</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">âœ…</div>
                            <div class="stat-label">RAG</div>
                        </div>
                    </div>
                `, 'success');
            } catch (error) {
                document.getElementById('systemStatus').className = 'status offline';
                document.getElementById('systemStatus').textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                
                showResult('statusResult', `
                    <h3>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</h3>
                    <p>${error.message}</p>
                `, 'error');
            }
        }
        
        // OpenAI Tests
        async function testOpenAI() {
            showLoading('openaiResult');
            const prompt = document.getElementById('openaiPrompt').value;
            const model = document.getElementById('modelSelect').value;
            
            try {
                const response = await fetch(`${API_BASE}/ai/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: prompt }],
                        options: { 
                            model: model === 'auto' ? undefined : model,
                            autoSelectModel: model === 'auto'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('openaiResult', `
                        <h3>âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                        <p><strong>Ø§Ù„Ø±Ø¯:</strong> ${data.response?.substring(0, 200)}...</p>
                        <p><strong>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</strong> ${data.model || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><strong>Ø§Ù„ØªÙƒÙ„ÙØ©:</strong> $${data.cost || '0.000'}</p>
                    `, 'success');
                } else {
                    showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testSmartModelSelection() {
            showLoading('openaiResult');
            
            const tests = [
                { prompt: '2+2=?', type: 'simple' },
                { prompt: 'Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© xÂ²+4x+4=0', type: 'math' },
                { prompt: 'Ø§ÙƒØªØ¨ Ù‚ØµØ© Ù‚ØµÙŠØ±Ø©', type: 'creative' }
            ];
            
            let results = [];
            
            for (const test of tests) {
                try {
                    const response = await fetch(`${API_BASE}/ai/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: [{ role: 'user', content: test.prompt }],
                            options: { autoSelectModel: true }
                        })
                    });
                    
                    const data = await response.json();
                    results.push({
                        type: test.type,
                        model: data.model || 'unknown',
                        success: data.success
                    });
                } catch (error) {
                    results.push({
                        type: test.type,
                        model: 'error',
                        success: false
                    });
                }
            }
            
            showResult('openaiResult', `
                <h3>ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒÙŠ</h3>
                ${results.map(r => `
                    <p>${r.success ? 'âœ…' : 'âŒ'} ${r.type}: ${r.model}</p>
                `).join('')}
            `, 'success');
        }
        
        async function testTaskDetection() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/task-detection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: document.getElementById('openaiPrompt').value })
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>ğŸ¯ ÙƒØ´Ù Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
                    <p><strong>Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØªØ´Ù:</strong> ${data.taskType}</p>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testCostOptimization() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/cost-optimization`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>ğŸ’° ØªÙˆÙÙŠØ± Ø§Ù„ØªÙƒÙ„ÙØ©</h3>
                    ${data.results.map(r => `
                        <p><strong>${r.prompt}:</strong> $${r.cost} (${r.time}ms)</p>
                    `).join('')}
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testJSONGeneration() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/json-generation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>ğŸ“‹ ØªÙˆÙ„ÙŠØ¯ JSON</h3>
                    ${formatJSON(data.json)}
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testOpenAIPerformance() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/performance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
                    <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª:</strong> ${Math.round(data.averageTime)}ms</p>
                    <p><strong>Ø§Ù„Ø£ÙˆÙ‚Ø§Øª:</strong> ${data.times.map(t => `${t}ms`).join(', ')}</p>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getOpenAIStats() {
            showLoading('openaiResult');
            
            try {
                const response = await fetch(`${API_BASE}/ai/stats`);
                const data = await response.json();
                
                showResult('openaiResult', `
                    <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª OpenAI</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${data.requestCount || 0}</div>
                            <div class="stat-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">$${data.totalCost || 0}</div>
                            <div class="stat-label">Ø§Ù„ØªÙƒÙ„ÙØ©</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.round(data.cacheHitRate || 0)}%</div>
                            <div class="stat-label">Cache Hit</div>
                        </div>
                    </div>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function clearOpenAICache() {
            try {
                const response = await fetch(`${API_BASE}/ai/clear-cache`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `<h3>âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´</h3>`, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // RAG Tests
        async function testRAG() {
            showLoading('ragResult');
            const question = document.getElementById('ragQuestion').value;
            const lessonId = document.getElementById('ragLessonId').value;
            
            try {
                const response = await fetch(`${API_BASE}/rag/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, lessonId: lessonId || undefined })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>âœ… Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«</h3>
                        <p><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong> ${data.answer?.substring(0, 300)}...</p>
                        <p><strong>Ø§Ù„Ø«Ù‚Ø©:</strong> ${data.confidence}%</p>
                        <p><strong>Ø§Ù„Ù…ØµØ§Ø¯Ø±:</strong> ${data.sources?.length || 0} Ù…ØµØ¯Ø±</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testRAGWithContext() {
            showLoading('ragResult');
            const question = document.getElementById('ragQuestion').value;
            
            try {
                const response = await fetch(`${API_BASE}/rag/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        question,
                        lessonId: 'clq5vx3w3001el20878ub6y1i'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>ğŸ“š Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³ÙŠØ§Ù‚</h3>
                        <p><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong> ${data.answer?.substring(0, 300)}...</p>
                        <p><strong>Ø§Ù„Ø³ÙŠØ§Ù‚:</strong> Ø¯Ø±Ø³ Ù…Ø­Ø¯Ø¯</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateQuizQuestions() {
            showLoading('ragResult');
            const lessonId = document.getElementById('ragLessonId').value || 'clq5vx3w3001el20878ub6y1i';
            
            try {
                const response = await fetch(`${API_BASE}/rag/quiz-questions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        lessonId, 
                        count: 3,
                        userId: 'test-user'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>ğŸ“ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                        ${data.questions.map((q, i) => `
                            <div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                                <p><strong>Ø³${i+1}:</strong> ${q.question}</p>
                                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${q.type}</p>
                                <p><strong>Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</strong> ${q.difficulty}</p>
                                <p><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${q.points}</p>
                            </div>
                        `).join('')}
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function explainConcept() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/explain-concept`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        concept: document.getElementById('ragQuestion').value
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>ğŸ’¡ Ø´Ø±Ø­ Ø§Ù„Ù…ÙÙ‡ÙˆÙ…</h3>
                        <p>${data.explanation}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateStudyPlan() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/study-plan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: document.getElementById('userId').value
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>ğŸ“… Ø®Ø·Ø© Ø¯Ø±Ø§Ø³ÙŠØ© Ù…Ø®ØµØµØ©</h3>
                        <p>${data.plan}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function explainWrongAnswer() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/wrong-answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: 'Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ',
                        wrongAnswer: 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>âŒ Ø´Ø±Ø­ Ø§Ù„Ø®Ø·Ø£</h3>
                        <p>${data.explanation}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Quiz Tests
        async function generateQuiz() {
            showLoading('quizResult');
            const lessonId = document.getElementById('quizLessonId').value;
            const count = document.getElementById('questionCount').value;
            
            try {
                const response = await fetch(`${API_BASE}/quiz/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lessonId, count: parseInt(count) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('quizResult', `
                        <h3>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${data.questions.length}</p>
                        ${data.questions.map((q, i) => `
                            <div style="margin: 10px 0;">
                                <p><strong>${i+1}.</strong> ${q.question || q}</p>
                            </div>
                        `).join('')}
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function startQuizSession() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/adaptive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lessonId: document.getElementById('quizLessonId').value,
                        userId: 'test-user'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    currentSession = data.sessionId;
                    showResult('quizResult', `
                        <h3>ğŸ® Ø¬Ù„Ø³Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                        <p><strong>Session ID:</strong> ${data.sessionId}</p>
                        <p><strong>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${data.questions?.length || 0}</p>
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateAdaptiveQuiz() {
            showLoading('quizResult');
            const studentId = document.getElementById('studentId').value;
            const lessonId = document.getElementById('quizLessonId').value;
            
            try {
                const response = await fetch(`${API_BASE}/quiz/adaptive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        lessonId,
                        userId: studentId,
                        adaptiveDifficulty: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentSession = data.sessionId;
                    showResult('quizResult', `
                        <h3>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒÙŠÙÙŠ</h3>
                        <p><strong>Ù„Ù„Ø·Ø§Ù„Ø¨:</strong> ${studentId}</p>
                        <p><strong>Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> ${data.difficulty}</p>
                        <p><strong>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${data.questions?.length || 0}</p>
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function submitAnswer() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/submit-answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        attemptId: currentSession || 'test-session',
                        questionId: 'test-question',
                        answer: 'test-answer'
                    })
                });
                const data = await response.json();
                showResult('quizResult', `
                    <h3>âœ… ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</h3>
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getInstantFeedback() {
            showResult('quizResult', `
                <h3>ğŸ’¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙÙˆØ±ÙŠ</h3>
                <p>âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</p>
                <p>Ø´Ø±Ø­: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© Ù„Ø£Ù†...</p>
            `, 'success');
        }
        
        async function completeQuiz() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        attemptId: currentSession || 'test-session'
                    })
                });
                const data = await response.json();
                showResult('quizResult', `
                    <h3>ğŸ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                    <p>Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${data.score || 85}%</p>
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getQuizStatistics() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/stats?userId=test-user`);
                const data = await response.json();
                showResult('quizResult', `
                    <h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                    ${formatJSON(data.stats || {})}
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getQuizHistory() {
            showResult('quizResult', `
                <h3>ğŸ“œ Ø§Ù„Ø³Ø¬Ù„</h3>
                <p>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 1: 85%</p>
                <p>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 2: 90%</p>
                <p>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 3: 95%</p>
            `, 'success');
        }
        
        // Teaching Assistant Tests
        async function generateTeachingScript() {
            showLoading('teachingResult');
            
            const slideContent = {
                title: 'Ø§Ù„ÙƒØ³ÙˆØ±',
                content: document.getElementById('slideContent').value
            };
            
            const options = {
                slideContent,
                lessonId: 'clq5vx3w3001el20878ub6y1i',
                studentName: document.getElementById('studentName').value,
                studentGrade: parseInt(document.getElementById('studentGrade').value)
            };
            
            try {
                const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(options)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ¤ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p>${data.script?.substring(0, 500)}...</p>
                        </div>
                        <p><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${data.duration} Ø«Ø§Ù†ÙŠØ©</p>
                        <p><strong>Ø§Ù„Ù†Ø¨Ø±Ø©:</strong> ${data.emotionalTone}</p>
                    `, 'success');
                } else {
                    showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateEmotionalScript() {
            showLoading('teachingResult');
            
            const emotionalState = {
                mood: document.getElementById('emotionalState').value,
                confidence: 50,
                engagement: 60,
                needsBreak: false
            };
            
            const options = {
                slideContent: { content: 'Ø¯Ø±Ø³ ØªØ¬Ø±ÙŠØ¨ÙŠ' },
                lessonId: 'clq5vx3w3001el20878ub6y1i',
                studentName: document.getElementById('studentName').value,
                studentGrade: parseInt(document.getElementById('studentGrade').value),
                emotionalState
            };
            
            try {
                const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(options)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ’– Ø³ÙƒØ±ÙŠØ¨Øª Ù…Ø®ØµØµ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©</h3>
                        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${emotionalState.mood}</p>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p>${data.script?.substring(0, 500)}...</p>
                        </div>
                    `, 'success');
                } else {
                    showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function detectEmotionalState() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/emotional-state`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ” Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©</h3>
                        <p><strong>Ø§Ù„Ù…Ø²Ø§Ø¬:</strong> ${data.emotionalState.mood}</p>
                        <p><strong>Ø§Ù„Ø«Ù‚Ø©:</strong> ${data.emotionalState.confidence}%</p>
                        <p><strong>Ø§Ù„ØªÙØ§Ø¹Ù„:</strong> ${data.emotionalState.engagement}%</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateMotivation() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/motivation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ’ª Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©</h3>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                            <p>${data.message}</p>
                        </div>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function handleInteraction() {
            showLoading('teachingResult');
            const interactionType = document.getElementById('interactionType').value;
            
            try {
                const response = await fetch(`${API_BASE}/teaching/interaction`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        interactionType,
                        currentSlide: { content: 'Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø±ÙŠØ­Ø©' },
                        lessonId: 'clq5vx3w3001el20878ub6y1i',
                        studentGrade: parseInt(document.getElementById('studentGrade').value)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ”„ Ø§Ù„ØªÙØ§Ø¹Ù„: ${interactionType}</h3>
                        <p>${data.script?.substring(0, 300)}...</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getProgressReport() {
            showLoading('teachingResult');
            
            try {
                const response = await fetch(`${API_BASE}/teaching/progress-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentName: document.getElementById('studentName').value,
                        studentGrade: parseInt(document.getElementById('studentGrade').value)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…</h3>
                        <p><strong>Ø§Ù„Ø¬Ù„Ø³Ø§Øª:</strong> ${data.totalSessions || 0}</p>
                        <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${data.totalLearningTime || '0 Ø¯Ù‚ÙŠÙ‚Ø©'}</p>
                        <p><strong>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:</strong> ${data.strengths?.join(', ') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ§Øª:</strong> ${data.recommendations?.join(', ') || 'Ø§Ø³ØªÙ…Ø±'}</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateParentReport() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/parent-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù‡Ù„</h3>
                        <p><strong>Ø§Ù„Ù…Ù„Ø®Øµ:</strong> ${data.report.summary}</p>
                        <p><strong>Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:</strong> ${data.report.strengths.join(', ')}</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ§Øª:</strong></p>
                        <ul>
                            ${data.report.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Integration Tests
        async function testFullFlow() {
            const progressBar = document.getElementById('integrationProgress');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            
            showResult('integrationResult', '<h3>ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„...</h3>', 'info');
            
            const steps = [
                { name: 'ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…', func: checkSystemStatus, weight: 10 },
                { name: 'Ø§Ø®ØªØ¨Ø§Ø± OpenAI', func: testOpenAI, weight: 20 },
                { name: 'Ø§Ø®ØªØ¨Ø§Ø± RAG', func: testRAG, weight: 20 },
                { name: 'ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±', func: generateQuiz, weight: 20 },
                { name: 'ØªÙˆÙ„ÙŠØ¯ Ø³ÙƒØ±ÙŠØ¨Øª', func: generateTeachingScript, weight: 30 }
            ];
            
            let progress = 0;
            let results = [];
            
            for (const step of steps) {
                try {
                    await step.func();
                    results.push(`âœ… ${step.name}`);
                } catch (error) {
                    results.push(`âŒ ${step.name}: ${error.message}`);
                }
                
                progress += step.weight;
                progressFill.style.width = `${progress}%`;
                progressFill.textContent = `${progress}%`;
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            showResult('integrationResult', `
                <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„</h3>
                ${results.map(r => `<p>${r}</p>`).join('')}
                <hr>
                <p><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> ${results.filter(r => r.includes('âœ…')).length}/${results.length} Ù†Ø¬Ø­</p>
            `, results.every(r => r.includes('âœ…')) ? 'success' : 'error');
            
            progressBar.style.display = 'none';
        }
        
        async function testAdaptiveLearning() {
            showLoading('integrationResult');
            
            const scenario = {
                studentName: 'Ù…Ø­Ù…Ø¯',
                grade: 6,
                sessions: 3
            };
            
            let results = [];
            
            for (let i = 1; i <= scenario.sessions; i++) {
                results.push(`<h4>Ø¬Ù„Ø³Ø© ${i}</h4>`);
                
                try {
                    const quizResponse = await fetch(`${API_BASE}/quiz/adaptive`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            userId: scenario.studentName
                        })
                    });
                    const quizData = await quizResponse.json();
                    results.push(`ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${quizData.success ? 'âœ…' : 'âŒ'}`);
                    
                    const scriptResponse = await fetch(`${API_BASE}/teaching/generate-script`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            slideContent: { title: `Ø¯Ø±Ø³ ${i}` },
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            studentName: scenario.studentName,
                            studentGrade: scenario.grade
                        })
                    });
                    const scriptData = await scriptResponse.json();
                    results.push(`ğŸ¤ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª: ${scriptData.success ? 'âœ…' : 'âŒ'}`);
                } catch (error) {
                    results.push(`âŒ Ø®Ø·Ø£: ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            showResult('integrationResult', `
                <h3>ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙƒÙŠÙÙŠ</h3>
                <p><strong>Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${scenario.studentName}</p>
                ${results.join('')}
                <hr>
                <p><strong>âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</strong></p>
            `, 'success');
        }
        
        async function testEmotionalFlow() {
            showLoading('integrationResult');
            
            const states = ['happy', 'confused', 'frustrated', 'tired'];
            let results = [];
            
            for (const state of states) {
                try {
                    const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            slideContent: { content: 'Ø¯Ø±Ø³ ØªØ¬Ø±ÙŠØ¨ÙŠ' },
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            studentName: 'Ø£Ø­Ù…Ø¯',
                            studentGrade: 6,
                            emotionalState: {
                                mood: state,
                                confidence: 50,
                                engagement: 50,
                                needsBreak: state === 'tired'
                            }
                        })
                    });
                    const data = await response.json();
                    results.push(`${state}: ${data.success ? 'âœ…' : 'âŒ'}`);
                } catch (error) {
                    results.push(`${state}: âŒ`);
                }
            }
            
            showResult('integrationResult', `
                <h3>ğŸ’– Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ</h3>
                ${results.map(r => `<p>${r}</p>`).join('')}
            `, 'success');
        }
        
        async function stressTest() {
            showLoading('integrationResult');
            
            try {
                const response = await fetch(`${API_BASE}/test/stress`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ requests: 5 })
                });
                
                const data = await response.json();
                
                showResult('integrationResult', `
                    <h3>âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ·</h3>
                    <p><strong>Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</strong> ${data.totalRequests}</p>
                    <p><strong>Ù†Ø¬Ø­:</strong> ${data.successful}</p>
                    <p><strong>ÙØ´Ù„:</strong> ${data.failed}</p>
                    <div class="stats-grid">
                        ${data.results.map(r => `
                            <div class="stat-item">
                                <div class="stat-value">${r.success ? 'âœ…' : 'âŒ'}</div>
                                <div class="stat-label">${r.time || 0}ms</div>
                            </div>
                        `).join('')}
                    </div>
                `, data.successful === data.totalRequests ? 'success' : 'error');
            } catch (error) {
                showResult('integrationResult', `<h3>âŒ Ø®Ø·Ø£</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Initialize on load
       window.onload = async function() {
    await getAvailableLessonId();
    checkSystemStatus();
};
    </script>
</body>
</html>