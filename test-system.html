<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 اختبار النظام التعليمي الذكي</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 5px solid #667eea;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .success-btn {
            background: #48bb78;
        }
        
        .success-btn:hover {
            background: #38a169;
        }
        
        .danger-btn {
            background: #f56565;
        }
        
        .danger-btn:hover {
            background: #e53e3e;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 10px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .result-box {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-box.success {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .result-box.error {
            border-color: #f56565;
            background: #fff5f5;
        }
        
        .result-box.info {
            border-color: #4299e1;
            background: #ebf8ff;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .status.online {
            background: #48bb78;
            color: white;
        }
        
        .status.offline {
            background: #f56565;
            color: white;
        }
        
        .status.testing {
            background: #ed8936;
            color: white;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .metric-card {
            padding: 15px;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        pre {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #48bb78);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat-item {
            padding: 10px;
            background: #f7fafc;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .stat-label {
            font-size: 11px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 اختبار النظام التعليمي الذكي</h1>
        <p class="subtitle">اختبار شامل لكل المكونات والخدمات - V2.0</p>
        
        <!-- System Status -->
        <div class="test-section">
            <h2>
                📊 حالة النظام
                <span id="systemStatus" class="status offline">غير متصل</span>
            </h2>
            <div class="grid">
                <div class="metric-card">
                    <div class="metric-value" id="apiStatus">⚫</div>
                    <div class="metric-label">API Server</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="dbStatus">⚫</div>
                    <div class="metric-label">Database</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="aiStatus">⚫</div>
                    <div class="metric-label">AI Services</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="ragStatus">⚫</div>
                    <div class="metric-label">RAG System</div>
                </div>
            </div>
            <button onclick="checkSystemStatus()">🔄 فحص الحالة</button>
            <div id="statusResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- OpenAI Service Test -->
        <div class="test-section">
            <h2>🤖 OpenAI Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('openai', 'basic')">أساسي</button>
                <button class="tab" onclick="switchTab('openai', 'smart')">ذكي</button>
                <button class="tab" onclick="switchTab('openai', 'performance')">الأداء</button>
            </div>
            
            <div id="openai-basic" class="tab-content active">
                <input type="text" id="openaiPrompt" placeholder="اكتب سؤال أو طلب..." value="اشرح الكسور للصف الخامس">
                <select id="modelSelect">
                    <option value="auto">اختيار تلقائي</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 (رخيص)</option>
                    <option value="gpt-4o-mini">GPT-4 Mini (متوازن)</option>
                    <option value="gpt-4o">GPT-4 (قوي)</option>
                </select>
                <button onclick="testOpenAI()">🚀 اختبر</button>
                <button onclick="testSmartModelSelection()" class="success-btn">🧠 اختبار الاختيار الذكي</button>
            </div>
            
            <div id="openai-smart" class="tab-content">
                <button onclick="testTaskDetection()">🎯 كشف نوع المهمة</button>
                <button onclick="testCostOptimization()">💰 اختبار توفير التكلفة</button>
                <button onclick="testJSONGeneration()">📋 توليد JSON</button>
            </div>
            
            <div id="openai-performance" class="tab-content">
                <button onclick="testOpenAIPerformance()">⚡ اختبار الأداء</button>
                <button onclick="getOpenAIStats()">📊 إحصائيات الاستخدام</button>
                <button onclick="clearOpenAICache()" class="danger-btn">🗑️ مسح الكاش</button>
            </div>
            
            <div id="openaiResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- RAG Service Test -->
        <div class="test-section">
            <h2>🔍 RAG Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('rag', 'qa')">أسئلة وأجوبة</button>
                <button class="tab" onclick="switchTab('rag', 'quiz')">اختبارات</button>
                <button class="tab" onclick="switchTab('rag', 'personalized')">شخصي</button>
            </div>
            
            <div id="rag-qa" class="tab-content active">
                <input type="text" id="ragQuestion" placeholder="اسأل سؤال..." value="ما هي المعادلة التربيعية؟">
                <input type="text" id="ragLessonId" placeholder="Lesson ID (اختياري)" value="">
                <button onclick="testRAG()">🔍 ابحث</button>
                <button onclick="testRAGWithContext()" class="success-btn">📚 بحث بالسياق</button>
            </div>
            
            <div id="rag-quiz" class="tab-content">
                <select id="quizDifficulty">
                    <option value="easy">سهل</option>
                    <option value="medium">متوسط</option>
                    <option value="hard">صعب</option>
                </select>
                <button onclick="generateQuizQuestions()">📝 توليد أسئلة</button>
                <button onclick="explainConcept()">💡 شرح مفهوم</button>
            </div>
            
            <div id="rag-personalized" class="tab-content">
                <input type="text" id="userId" placeholder="User ID" value="user123">
                <button onclick="generateStudyPlan()">📅 خطة دراسية</button>
                <button onclick="explainWrongAnswer()">❌ شرح خطأ</button>
            </div>
            
            <div id="ragResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Quiz Service Test -->
        <div class="test-section">
            <h2>📝 Quiz Service</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('quiz', 'generate')">توليد</button>
                <button class="tab" onclick="switchTab('quiz', 'adaptive')">تكيفي</button>
                <button class="tab" onclick="switchTab('quiz', 'analysis')">تحليل</button>
            </div>
            
            <div id="quiz-generate" class="tab-content active">
                <input type="text" id="quizLessonId" placeholder="Lesson ID" value="clq5vx3w3001el20878ub6y1i">
                <input type="number" id="questionCount" placeholder="عدد الأسئلة" value="5" min="1" max="10">
                <button onclick="generateQuiz()">📝 توليد اختبار</button>
                <button onclick="startQuizSession()" class="success-btn">🎮 بدء جلسة</button>
            </div>
            
            <div id="quiz-adaptive" class="tab-content">
                <input type="text" id="studentId" placeholder="Student ID" value="student123">
                <button onclick="generateAdaptiveQuiz()">🎯 اختبار تكيفي</button>
                <button onclick="submitAnswer()">✅ تسليم إجابة</button>
                <button onclick="getInstantFeedback()">💬 تقييم فوري</button>
            </div>
            
            <div id="quiz-analysis" class="tab-content">
                <button onclick="completeQuiz()">🏁 إنهاء الاختبار</button>
                <button onclick="getQuizStatistics()">📊 إحصائيات</button>
                <button onclick="getQuizHistory()">📜 السجل</button>
            </div>
            
            <div id="quizResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Teaching Assistant Test -->
        <div class="test-section">
            <h2>👨‍🏫 Teaching Assistant</h2>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('teaching', 'basic')">أساسي</button>
                <button class="tab" onclick="switchTab('teaching', 'emotional')">عاطفي</button>
                <button class="tab" onclick="switchTab('teaching', 'adaptive')">تكيفي</button>
            </div>
            
            <div id="teaching-basic" class="tab-content active">
                <textarea id="slideContent" placeholder="محتوى الشريحة..." rows="3">الكسور: هي أجزاء من الوحدة الكاملة</textarea>
                <input type="text" id="studentName" placeholder="اسم الطالب" value="أحمد">
                <input type="number" id="studentGrade" placeholder="الصف" value="5" min="1" max="12">
                <button onclick="generateTeachingScript()">🎤 توليد سكريبت</button>
            </div>
            
            <div id="teaching-emotional" class="tab-content">
                <select id="emotionalState">
                    <option value="happy">سعيد 😊</option>
                    <option value="neutral">عادي 😐</option>
                    <option value="frustrated">محبط 😔</option>
                    <option value="confused">مرتبك 😕</option>
                    <option value="tired">متعب 😴</option>
                </select>
                <button onclick="generateEmotionalScript()">💖 سكريبت عاطفي</button>
                <button onclick="detectEmotionalState()">🔍 كشف الحالة</button>
                <button onclick="generateMotivation()">💪 رسالة تحفيزية</button>
            </div>
            
            <div id="teaching-adaptive" class="tab-content">
                <select id="interactionType">
                    <option value="explain">شرح</option>
                    <option value="socratic">سقراطي</option>
                    <option value="example">مثال</option>
                    <option value="problem">مسألة</option>
                    <option value="hint">تلميح</option>
                    <option value="check">تحقق</option>
                </select>
                <button onclick="handleInteraction()">🔄 تفاعل</button>
                <button onclick="getProgressReport()">📈 تقرير التقدم</button>
                <button onclick="generateParentReport()">👨‍👩‍👧 تقرير الأهل</button>
            </div>
            
            <div id="teachingResult" class="result-box" style="display:none;"></div>
        </div>
        
        <!-- Integration Test -->
        <div class="test-section">
            <h2>🔗 اختبار التكامل</h2>
            <button onclick="testFullFlow()">🚀 اختبار كامل للنظام</button>
            <button onclick="testAdaptiveLearning()" class="success-btn">🧠 اختبار التعلم التكيفي</button>
            <button onclick="testEmotionalFlow()">💖 اختبار التدفق العاطفي</button>
            <button onclick="stressTest()" class="danger-btn">⚡ اختبار الضغط</button>
            <div class="progress-bar" id="integrationProgress" style="display:none;">
                <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
            </div>
            <div id="integrationResult" class="result-box" style="display:none;"></div>
        </div>
    </div>
    
    <script>

        // في بداية script section
let availableLessonId = null;

// Function للحصول على lesson ID صالح
async function getAvailableLessonId() {
    try {
        const response = await fetch(`${API_BASE}/lessons/available`);
        const data = await response.json();
        
        if (data.success && data.lessons.length > 0) {
            availableLessonId = data.lessons[0].id;
            console.log('✅ Using lesson ID:', availableLessonId);
            
            // حدث كل input fields
            document.getElementById('ragLessonId').value = availableLessonId;
            document.getElementById('quizLessonId').value = availableLessonId;
            
            // اعرض الدروس المتاحة
            showResult('statusResult', `
                <h3>📚 الدروس المتاحة:</h3>
                ${data.lessons.map(l => `
                    <p>• ${l.title} (${l.id})</p>
                `).join('')}
            `, 'info');
        } else {
            console.error('❌ No lessons with content found');
        }
    } catch (error) {
        console.error('Error fetching lessons:', error);
    }
}

        // Configuration
        const API_BASE = 'http://localhost:3000/api';
        let currentTest = null;
        let currentSession = null;
        
        // Utility Functions
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result-box ${type}`;
            element.innerHTML = content;
        }
        
        function showLoading(elementId) {
            showResult(elementId, '<div class="loading"></div> جاري المعالجة...', 'info');
        }
        
        function formatJSON(obj) {
            return `<pre>${JSON.stringify(obj, null, 2)}</pre>`;
        }
        
        function switchTab(section, tab) {
            // Hide all tabs in section
            document.querySelectorAll(`#${section}- .tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(`${section}-${tab}`).classList.add('active');
            
            // Update tab buttons
            const buttons = event.target.parentElement.querySelectorAll('.tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // System Status Check
        async function checkSystemStatus() {
            showLoading('statusResult');
            
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                // Update status indicators
                document.getElementById('systemStatus').className = 'status online';
                document.getElementById('systemStatus').textContent = 'متصل';
                
                document.getElementById('apiStatus').textContent = '🟢';
                document.getElementById('dbStatus').textContent = data.database ? '🟢' : '🔴';
                document.getElementById('aiStatus').textContent = data.openai ? '🟢' : '🟡';
                document.getElementById('ragStatus').textContent = data.rag ? '🟢' : '🟡';
                
                showResult('statusResult', `
                    <h3>✅ النظام يعمل بشكل جيد</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">✅</div>
                            <div class="stat-label">API</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">✅</div>
                            <div class="stat-label">Database</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${data.openai ? '✅' : '⚠️'}</div>
                            <div class="stat-label">OpenAI</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">✅</div>
                            <div class="stat-label">RAG</div>
                        </div>
                    </div>
                `, 'success');
            } catch (error) {
                document.getElementById('systemStatus').className = 'status offline';
                document.getElementById('systemStatus').textContent = 'غير متصل';
                
                showResult('statusResult', `
                    <h3>❌ خطأ في الاتصال</h3>
                    <p>${error.message}</p>
                `, 'error');
            }
        }
        
        // OpenAI Tests
        async function testOpenAI() {
            showLoading('openaiResult');
            const prompt = document.getElementById('openaiPrompt').value;
            const model = document.getElementById('modelSelect').value;
            
            try {
                const response = await fetch(`${API_BASE}/ai/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: prompt }],
                        options: { 
                            model: model === 'auto' ? undefined : model,
                            autoSelectModel: model === 'auto'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('openaiResult', `
                        <h3>✅ نجح الاختبار</h3>
                        <p><strong>الرد:</strong> ${data.response?.substring(0, 200)}...</p>
                        <p><strong>الموديل:</strong> ${data.model || 'غير محدد'}</p>
                        <p><strong>التكلفة:</strong> $${data.cost || '0.000'}</p>
                    `, 'success');
                } else {
                    showResult('openaiResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testSmartModelSelection() {
            showLoading('openaiResult');
            
            const tests = [
                { prompt: '2+2=?', type: 'simple' },
                { prompt: 'حل المعادلة x²+4x+4=0', type: 'math' },
                { prompt: 'اكتب قصة قصيرة', type: 'creative' }
            ];
            
            let results = [];
            
            for (const test of tests) {
                try {
                    const response = await fetch(`${API_BASE}/ai/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: [{ role: 'user', content: test.prompt }],
                            options: { autoSelectModel: true }
                        })
                    });
                    
                    const data = await response.json();
                    results.push({
                        type: test.type,
                        model: data.model || 'unknown',
                        success: data.success
                    });
                } catch (error) {
                    results.push({
                        type: test.type,
                        model: 'error',
                        success: false
                    });
                }
            }
            
            showResult('openaiResult', `
                <h3>🧠 اختبار الاختيار الذكي</h3>
                ${results.map(r => `
                    <p>${r.success ? '✅' : '❌'} ${r.type}: ${r.model}</p>
                `).join('')}
            `, 'success');
        }
        
        async function testTaskDetection() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/task-detection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: document.getElementById('openaiPrompt').value })
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>🎯 كشف نوع المهمة</h3>
                    <p><strong>النوع المكتشف:</strong> ${data.taskType}</p>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testCostOptimization() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/cost-optimization`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>💰 توفير التكلفة</h3>
                    ${data.results.map(r => `
                        <p><strong>${r.prompt}:</strong> $${r.cost} (${r.time}ms)</p>
                    `).join('')}
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testJSONGeneration() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/json-generation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>📋 توليد JSON</h3>
                    ${formatJSON(data.json)}
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testOpenAIPerformance() {
            showLoading('openaiResult');
            try {
                const response = await fetch(`${API_BASE}/test/performance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `
                    <h3>⚡ اختبار الأداء</h3>
                    <p><strong>متوسط الوقت:</strong> ${Math.round(data.averageTime)}ms</p>
                    <p><strong>الأوقات:</strong> ${data.times.map(t => `${t}ms`).join(', ')}</p>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getOpenAIStats() {
            showLoading('openaiResult');
            
            try {
                const response = await fetch(`${API_BASE}/ai/stats`);
                const data = await response.json();
                
                showResult('openaiResult', `
                    <h3>📊 إحصائيات OpenAI</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${data.requestCount || 0}</div>
                            <div class="stat-label">الطلبات</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">$${data.totalCost || 0}</div>
                            <div class="stat-label">التكلفة</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.round(data.cacheHitRate || 0)}%</div>
                            <div class="stat-label">Cache Hit</div>
                        </div>
                    </div>
                `, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function clearOpenAICache() {
            try {
                const response = await fetch(`${API_BASE}/ai/clear-cache`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                showResult('openaiResult', `<h3>✅ تم مسح الكاش</h3>`, 'success');
            } catch (error) {
                showResult('openaiResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // RAG Tests
        async function testRAG() {
            showLoading('ragResult');
            const question = document.getElementById('ragQuestion').value;
            const lessonId = document.getElementById('ragLessonId').value;
            
            try {
                const response = await fetch(`${API_BASE}/rag/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, lessonId: lessonId || undefined })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>✅ نتيجة البحث</h3>
                        <p><strong>الإجابة:</strong> ${data.answer?.substring(0, 300)}...</p>
                        <p><strong>الثقة:</strong> ${data.confidence}%</p>
                        <p><strong>المصادر:</strong> ${data.sources?.length || 0} مصدر</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function testRAGWithContext() {
            showLoading('ragResult');
            const question = document.getElementById('ragQuestion').value;
            
            try {
                const response = await fetch(`${API_BASE}/rag/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        question,
                        lessonId: 'clq5vx3w3001el20878ub6y1i'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>📚 بحث بالسياق</h3>
                        <p><strong>الإجابة:</strong> ${data.answer?.substring(0, 300)}...</p>
                        <p><strong>السياق:</strong> درس محدد</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateQuizQuestions() {
            showLoading('ragResult');
            const lessonId = document.getElementById('ragLessonId').value || 'clq5vx3w3001el20878ub6y1i';
            
            try {
                const response = await fetch(`${API_BASE}/rag/quiz-questions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        lessonId, 
                        count: 3,
                        userId: 'test-user'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>📝 أسئلة الاختبار</h3>
                        ${data.questions.map((q, i) => `
                            <div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                                <p><strong>س${i+1}:</strong> ${q.question}</p>
                                <p><strong>النوع:</strong> ${q.type}</p>
                                <p><strong>الصعوبة:</strong> ${q.difficulty}</p>
                                <p><strong>النقاط:</strong> ${q.points}</p>
                            </div>
                        `).join('')}
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function explainConcept() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/explain-concept`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        concept: document.getElementById('ragQuestion').value
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>💡 شرح المفهوم</h3>
                        <p>${data.explanation}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateStudyPlan() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/study-plan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: document.getElementById('userId').value
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>📅 خطة دراسية مخصصة</h3>
                        <p>${data.plan}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function explainWrongAnswer() {
            showLoading('ragResult');
            try {
                const response = await fetch(`${API_BASE}/rag/wrong-answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: 'سؤال تجريبي',
                        wrongAnswer: 'إجابة خاطئة'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('ragResult', `
                        <h3>❌ شرح الخطأ</h3>
                        <p>${data.explanation}</p>
                    `, 'success');
                } else {
                    showResult('ragResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('ragResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Quiz Tests
        async function generateQuiz() {
            showLoading('quizResult');
            const lessonId = document.getElementById('quizLessonId').value;
            const count = document.getElementById('questionCount').value;
            
            try {
                const response = await fetch(`${API_BASE}/quiz/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lessonId, count: parseInt(count) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('quizResult', `
                        <h3>📝 اختبار جديد</h3>
                        <p><strong>عدد الأسئلة:</strong> ${data.questions.length}</p>
                        ${data.questions.map((q, i) => `
                            <div style="margin: 10px 0;">
                                <p><strong>${i+1}.</strong> ${q.question || q}</p>
                            </div>
                        `).join('')}
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function startQuizSession() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/adaptive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lessonId: document.getElementById('quizLessonId').value,
                        userId: 'test-user'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    currentSession = data.sessionId;
                    showResult('quizResult', `
                        <h3>🎮 جلسة الاختبار</h3>
                        <p><strong>Session ID:</strong> ${data.sessionId}</p>
                        <p><strong>الأسئلة:</strong> ${data.questions?.length || 0}</p>
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateAdaptiveQuiz() {
            showLoading('quizResult');
            const studentId = document.getElementById('studentId').value;
            const lessonId = document.getElementById('quizLessonId').value;
            
            try {
                const response = await fetch(`${API_BASE}/quiz/adaptive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        lessonId,
                        userId: studentId,
                        adaptiveDifficulty: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentSession = data.sessionId;
                    showResult('quizResult', `
                        <h3>🎯 اختبار تكيفي</h3>
                        <p><strong>للطالب:</strong> ${studentId}</p>
                        <p><strong>المستوى:</strong> ${data.difficulty}</p>
                        <p><strong>الأسئلة:</strong> ${data.questions?.length || 0}</p>
                    `, 'success');
                } else {
                    showResult('quizResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function submitAnswer() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/submit-answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        attemptId: currentSession || 'test-session',
                        questionId: 'test-question',
                        answer: 'test-answer'
                    })
                });
                const data = await response.json();
                showResult('quizResult', `
                    <h3>✅ تم تسليم الإجابة</h3>
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getInstantFeedback() {
            showResult('quizResult', `
                <h3>💬 التقييم الفوري</h3>
                <p>✅ إجابة صحيحة!</p>
                <p>شرح: الإجابة صحيحة لأن...</p>
            `, 'success');
        }
        
        async function completeQuiz() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        attemptId: currentSession || 'test-session'
                    })
                });
                const data = await response.json();
                showResult('quizResult', `
                    <h3>🏁 اكتمل الاختبار</h3>
                    <p>النتيجة: ${data.score || 85}%</p>
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getQuizStatistics() {
            showLoading('quizResult');
            try {
                const response = await fetch(`${API_BASE}/quiz/stats?userId=test-user`);
                const data = await response.json();
                showResult('quizResult', `
                    <h3>📊 الإحصائيات</h3>
                    ${formatJSON(data.stats || {})}
                `, 'success');
            } catch (error) {
                showResult('quizResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getQuizHistory() {
            showResult('quizResult', `
                <h3>📜 السجل</h3>
                <p>الاختبار 1: 85%</p>
                <p>الاختبار 2: 90%</p>
                <p>الاختبار 3: 95%</p>
            `, 'success');
        }
        
        // Teaching Assistant Tests
        async function generateTeachingScript() {
            showLoading('teachingResult');
            
            const slideContent = {
                title: 'الكسور',
                content: document.getElementById('slideContent').value
            };
            
            const options = {
                slideContent,
                lessonId: 'clq5vx3w3001el20878ub6y1i',
                studentName: document.getElementById('studentName').value,
                studentGrade: parseInt(document.getElementById('studentGrade').value)
            };
            
            try {
                const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(options)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>🎤 السكريبت التعليمي</h3>
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p>${data.script?.substring(0, 500)}...</p>
                        </div>
                        <p><strong>المدة:</strong> ${data.duration} ثانية</p>
                        <p><strong>النبرة:</strong> ${data.emotionalTone}</p>
                    `, 'success');
                } else {
                    showResult('teachingResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateEmotionalScript() {
            showLoading('teachingResult');
            
            const emotionalState = {
                mood: document.getElementById('emotionalState').value,
                confidence: 50,
                engagement: 60,
                needsBreak: false
            };
            
            const options = {
                slideContent: { content: 'درس تجريبي' },
                lessonId: 'clq5vx3w3001el20878ub6y1i',
                studentName: document.getElementById('studentName').value,
                studentGrade: parseInt(document.getElementById('studentGrade').value),
                emotionalState
            };
            
            try {
                const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(options)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>💖 سكريبت مخصص للحالة العاطفية</h3>
                        <p><strong>الحالة:</strong> ${emotionalState.mood}</p>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p>${data.script?.substring(0, 500)}...</p>
                        </div>
                    `, 'success');
                } else {
                    showResult('teachingResult', `<h3>❌ خطأ</h3><p>${data.error}</p>`, 'error');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function detectEmotionalState() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/emotional-state`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>🔍 الحالة العاطفية</h3>
                        <p><strong>المزاج:</strong> ${data.emotionalState.mood}</p>
                        <p><strong>الثقة:</strong> ${data.emotionalState.confidence}%</p>
                        <p><strong>التفاعل:</strong> ${data.emotionalState.engagement}%</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateMotivation() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/motivation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>💪 رسالة تحفيزية</h3>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                            <p>${data.message}</p>
                        </div>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function handleInteraction() {
            showLoading('teachingResult');
            const interactionType = document.getElementById('interactionType').value;
            
            try {
                const response = await fetch(`${API_BASE}/teaching/interaction`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        interactionType,
                        currentSlide: { content: 'محتوى الشريحة' },
                        lessonId: 'clq5vx3w3001el20878ub6y1i',
                        studentGrade: parseInt(document.getElementById('studentGrade').value)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>🔄 التفاعل: ${interactionType}</h3>
                        <p>${data.script?.substring(0, 300)}...</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function getProgressReport() {
            showLoading('teachingResult');
            
            try {
                const response = await fetch(`${API_BASE}/teaching/progress-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentName: document.getElementById('studentName').value,
                        studentGrade: parseInt(document.getElementById('studentGrade').value)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>📈 تقرير التقدم</h3>
                        <p><strong>الجلسات:</strong> ${data.totalSessions || 0}</p>
                        <p><strong>الوقت:</strong> ${data.totalLearningTime || '0 دقيقة'}</p>
                        <p><strong>نقاط القوة:</strong> ${data.strengths?.join(', ') || 'لا يوجد'}</p>
                        <p><strong>التوصيات:</strong> ${data.recommendations?.join(', ') || 'استمر'}</p>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        async function generateParentReport() {
            showLoading('teachingResult');
            try {
                const response = await fetch(`${API_BASE}/teaching/parent-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('teachingResult', `
                        <h3>👨‍👩‍👧 تقرير الأهل</h3>
                        <p><strong>الملخص:</strong> ${data.report.summary}</p>
                        <p><strong>نقاط القوة:</strong> ${data.report.strengths.join(', ')}</p>
                        <p><strong>التوصيات:</strong></p>
                        <ul>
                            ${data.report.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    `, 'success');
                }
            } catch (error) {
                showResult('teachingResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Integration Tests
        async function testFullFlow() {
            const progressBar = document.getElementById('integrationProgress');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            
            showResult('integrationResult', '<h3>🚀 بدء الاختبار الكامل...</h3>', 'info');
            
            const steps = [
                { name: 'فحص النظام', func: checkSystemStatus, weight: 10 },
                { name: 'اختبار OpenAI', func: testOpenAI, weight: 20 },
                { name: 'اختبار RAG', func: testRAG, weight: 20 },
                { name: 'توليد اختبار', func: generateQuiz, weight: 20 },
                { name: 'توليد سكريبت', func: generateTeachingScript, weight: 30 }
            ];
            
            let progress = 0;
            let results = [];
            
            for (const step of steps) {
                try {
                    await step.func();
                    results.push(`✅ ${step.name}`);
                } catch (error) {
                    results.push(`❌ ${step.name}: ${error.message}`);
                }
                
                progress += step.weight;
                progressFill.style.width = `${progress}%`;
                progressFill.textContent = `${progress}%`;
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            showResult('integrationResult', `
                <h3>📊 نتائج الاختبار الكامل</h3>
                ${results.map(r => `<p>${r}</p>`).join('')}
                <hr>
                <p><strong>النتيجة:</strong> ${results.filter(r => r.includes('✅')).length}/${results.length} نجح</p>
            `, results.every(r => r.includes('✅')) ? 'success' : 'error');
            
            progressBar.style.display = 'none';
        }
        
        async function testAdaptiveLearning() {
            showLoading('integrationResult');
            
            const scenario = {
                studentName: 'محمد',
                grade: 6,
                sessions: 3
            };
            
            let results = [];
            
            for (let i = 1; i <= scenario.sessions; i++) {
                results.push(`<h4>جلسة ${i}</h4>`);
                
                try {
                    const quizResponse = await fetch(`${API_BASE}/quiz/adaptive`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            userId: scenario.studentName
                        })
                    });
                    const quizData = await quizResponse.json();
                    results.push(`📝 الاختبار: ${quizData.success ? '✅' : '❌'}`);
                    
                    const scriptResponse = await fetch(`${API_BASE}/teaching/generate-script`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            slideContent: { title: `درس ${i}` },
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            studentName: scenario.studentName,
                            studentGrade: scenario.grade
                        })
                    });
                    const scriptData = await scriptResponse.json();
                    results.push(`🎤 السكريبت: ${scriptData.success ? '✅' : '❌'}`);
                } catch (error) {
                    results.push(`❌ خطأ: ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            showResult('integrationResult', `
                <h3>🧠 اختبار التعلم التكيفي</h3>
                <p><strong>الطالب:</strong> ${scenario.studentName}</p>
                ${results.join('')}
                <hr>
                <p><strong>✅ اكتمل الاختبار</strong></p>
            `, 'success');
        }
        
        async function testEmotionalFlow() {
            showLoading('integrationResult');
            
            const states = ['happy', 'confused', 'frustrated', 'tired'];
            let results = [];
            
            for (const state of states) {
                try {
                    const response = await fetch(`${API_BASE}/teaching/generate-script`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            slideContent: { content: 'درس تجريبي' },
                            lessonId: 'clq5vx3w3001el20878ub6y1i',
                            studentName: 'أحمد',
                            studentGrade: 6,
                            emotionalState: {
                                mood: state,
                                confidence: 50,
                                engagement: 50,
                                needsBreak: state === 'tired'
                            }
                        })
                    });
                    const data = await response.json();
                    results.push(`${state}: ${data.success ? '✅' : '❌'}`);
                } catch (error) {
                    results.push(`${state}: ❌`);
                }
            }
            
            showResult('integrationResult', `
                <h3>💖 اختبار التدفق العاطفي</h3>
                ${results.map(r => `<p>${r}</p>`).join('')}
            `, 'success');
        }
        
        async function stressTest() {
            showLoading('integrationResult');
            
            try {
                const response = await fetch(`${API_BASE}/test/stress`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ requests: 5 })
                });
                
                const data = await response.json();
                
                showResult('integrationResult', `
                    <h3>⚡ اختبار الضغط</h3>
                    <p><strong>الطلبات:</strong> ${data.totalRequests}</p>
                    <p><strong>نجح:</strong> ${data.successful}</p>
                    <p><strong>فشل:</strong> ${data.failed}</p>
                    <div class="stats-grid">
                        ${data.results.map(r => `
                            <div class="stat-item">
                                <div class="stat-value">${r.success ? '✅' : '❌'}</div>
                                <div class="stat-label">${r.time || 0}ms</div>
                            </div>
                        `).join('')}
                    </div>
                `, data.successful === data.totalRequests ? 'success' : 'error');
            } catch (error) {
                showResult('integrationResult', `<h3>❌ خطأ</h3><p>${error.message}</p>`, 'error');
            }
        }
        
        // Initialize on load
       window.onload = async function() {
    await getAvailableLessonId();
    checkSystemStatus();
};
    </script>
</body>
</html>